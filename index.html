<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="favicon.ico">
    <title>Merry Christmas, My Love!</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #B91C1C 0%, #047857 50%, #FFC107 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.5s ease-out;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .loading-content {
            text-align: center;
            color: white;
            width: 100%;
            max-width: 500px;
            padding: 0 20px;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-bar-container {
            width: 300px;
            max-width: 90%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto 0 auto;
        }

        .loading-bar {
            height: 100%;
            background: white;
            width: 0%;
            animation: loadProgress 2s ease-in-out forwards;
            border-radius: 10px;
        }

        @keyframes loadProgress {
            to { width: 100%; }
        }

        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            background: linear-gradient(135deg, #DC143C 0%, #FFD700 50%, #DC143C 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }

        .dancing-font {
            font-family: 'Dancing Script', cursive;
        }

        /* Snowflakes animation */
        .snowflake {
            position: fixed;
            top: -10px;
            z-index: 0;
            user-select: none;
            pointer-events: none;
            color: white;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 255, 255, 0.5);
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        /* Welcome Screen Styles */
        #welcome-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            animation: fadeInScale 1s ease-out;
        }

        #welcome-screen.fade-out {
            animation: simpleFadeOut 0.5s ease-out forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes simpleFadeOut {
            to {
                opacity: 0;
            }
        }

        /* Polaroid Photo Frame */
        .polaroid-frame {
            position: relative;
            width: 160px;
            margin-bottom: 20px;
            animation: spin-polaroid 12s ease-in-out infinite;
            transform-style: preserve-3d;
        }

        @media (min-width: 640px) {
            .polaroid-frame {
                width: 240px;
                margin-bottom: 30px;
            }
        }

        /* Christmas lights around polaroid */
        .polaroid-frame::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 4px;
            background: linear-gradient(
                90deg,
                #ff0000 0%, #00ff00 10%, #ffff00 20%, #ff0000 30%,
                #00ff00 40%, #ffff00 50%, #ff0000 60%, #00ff00 70%,
                #ffff00 80%, #ff0000 90%, #00ff00 100%
            );
            background-size: 200% 100%;
            animation: lights-move 3s linear infinite;
            z-index: -1;
            filter: blur(2px);
            opacity: 0.8;
        }

        @keyframes lights-move {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        @keyframes spin-polaroid {
            0%, 100% { transform: rotateY(0deg) rotateZ(-5deg); }
            25% { transform: rotateY(180deg) rotateZ(5deg); }
            50% { transform: rotateY(360deg) rotateZ(-3deg); }
            75% { transform: rotateY(540deg) rotateZ(3deg); }
        }

        @keyframes fade-swap {
            0%, 47% { opacity: 1; }
            50% { opacity: 0; }
            53%, 100% { opacity: 0; }
        }

        .polaroid-img {
            animation: fade-swap 12s ease-in-out infinite;
        }

        .polaroid-img.second {
            position: absolute;
            top: 12px;
            left: 12px;
            width: calc(100% - 24px);
            animation: fade-swap 12s ease-in-out infinite;
            animation-delay: 6s;
            object-position: center 100%;
        }

        .polaroid-inner {
            background: white;
            padding: 12px 12px 40px 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-radius: 2px;
            position: relative;
        }

        .polaroid-img {
            width: 100%;
            height: auto;
            aspect-ratio: 1;
            object-fit: cover;
            display: block;
            position: relative;
        }

        .polaroid-caption {
            position: absolute;
            bottom: 8px;
            left: 0;
            right: 0;
            text-align: center;
            font-family: 'Dancing Script', cursive;
            font-size: 18px;
            color: #333;
        }

        @media (min-width: 640px) {
            .polaroid-caption {
                font-size: 22px;
            }
        }

        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
        }

        .start-btn {
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(185, 28, 28, 0.3);
        }

        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(185, 28, 28, 0.4);
        }

        /* Quiz Screen Styles */
        #quiz-screen {
            display: none;
            min-height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        #quiz-screen.show {
            animation: simpleFadeIn 0.5s ease-out;
        }

        #quiz-screen.fade-out {
            animation: simpleFadeOut 0.5s ease-out forwards;
        }

        @keyframes simpleFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .quiz-card {
            background: white;
            border-radius: 20px;
            padding: 20px 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
            position: relative;
            z-index: 10;
        }

        @media (min-width: 640px) {
            .quiz-card {
                padding: 40px;
            }
        }

        .answer-btn {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            background-color: white;
            font-size: 14px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        @media (min-width: 640px) {
            .answer-btn {
                font-size: 16px;
            }
        }

        .answer-btn:hover:not(.dodging):not(:disabled) {
            transform: translateX(5px);
            border-color: #B91C1C;
            background-color: #FEF2F2;
        }

        .answer-btn:active:not(.dodging):not(:disabled) {
            transform: scale(0.98);
        }

        .answer-btn.dodging,
        .answer-btn.dodging:hover,
        .answer-btn.dodging:active {
            border-color: #e5e7eb !important;
            background-color: white !important;
        }

        .answer-btn.correct {
            background-color: #D1FAE5 !important;
            border-color: #047857 !important;
        }

        .answer-btn.wrong {
            background-color: #FEE2E2;
            border-color: #B91C1C;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .answer-btn.dodging {
            transition: transform 0.3s ease;
        }

        .quiz-progress {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 20px;
        }

        .wrong-answer-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transition: transform 0.3s ease;
        }

        @media (min-width: 640px) {
            .wrong-answer-popup {
                padding: 40px;
            }
        }

        .wrong-answer-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .wrong-answer-popup h3 {
            font-size: 28px;
        }

        @media (min-width: 640px) {
            .wrong-answer-popup h3 {
                font-size: 36px;
            }
        }

        .wrong-answer-popup p {
            font-size: 16px;
        }

        @media (min-width: 640px) {
            .wrong-answer-popup p {
                font-size: 18px;
            }
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: none;
        }

        .popup-overlay.show {
            display: block;
        }

        /* Scratch Game Styles */
        #scratch-screen {
            display: none;
            min-height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        #scratch-screen.show {
            animation: bounceIn 1s ease-out;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(-100%);
            }
            50% {
                opacity: 1;
                transform: scale(1.05) translateY(0);
            }
            70% {
                transform: scale(0.95);
            }
            100% {
                transform: scale(1);
            }
        }

        #scratch-canvas {
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            cursor: grab;
            max-width: 100%;
            touch-action: none;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        #scratch-canvas:active {
            cursor: grabbing;
        }

        #scratch-canvas.flip-3d {
            animation: flip3d 0.8s ease-in-out;
        }

        @keyframes flip3d {
            0% {
                transform: rotateY(0deg) scale(1);
            }
            50% {
                transform: rotateY(90deg) scale(0.95);
            }
            100% {
                transform: rotateY(180deg) scale(1);
            }
        }

        .scratch-hint {
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Prize Reveal Styles */
        #prize-screen {
            display: none;
            min-height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        #prize-screen.show {
            animation: spiralIn 1.2s ease-out;
        }

        @keyframes spiralIn {
            0% {
                opacity: 0;
                transform: rotate(720deg) scale(0);
            }
            100% {
                opacity: 1;
                transform: rotate(0deg) scale(1);
            }
        }

        .fade-in {
            animation: fadeIn 1.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scale-in {
            animation: scaleIn 0.8s ease-out;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Chocolate Rain */
        .chocolate {
            position: fixed;
            font-size: 30px;
            z-index: 1000;
            pointer-events: none;
            animation: chocolateFall linear infinite;
            top: -100px;
        }

        @keyframes chocolateFall {
            to {
                transform: translateY(calc(100vh + 100px)) rotate(360deg);
            }
        }

        .sparkle {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #FFC107;
            border-radius: 50%;
            animation: sparkleAnim 1s ease-out forwards;
            pointer-events: none;
            z-index: 1001;
        }

        @keyframes sparkleAnim {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: scale(3) rotate(180deg);
                opacity: 0;
            }
        }


        .gift-card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
            position: relative;
            z-index: 10;
        }

        @media (min-width: 640px) {
            .gift-card {
                padding: 40px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Coupon Modal Styles */
        #coupon-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        #coupon-modal.show {
            display: flex;
            animation: fadeInModal 0.4s ease-out;
        }

        @keyframes fadeInModal {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .coupon-container {
            position: relative;
            max-width: 90%;
            max-height: 90vh;
            animation: slideUpBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideUpBounce {
            0% {
                opacity: 0;
                transform: translateY(100px) scale(0.8) rotate(-5deg);
            }
            70% {
                transform: translateY(-10px) scale(1.05) rotate(2deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
        }

        .coupon-image {
            max-width: 100%;
            max-height: 85vh;
            border-radius: 15px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            border: 3px solid #FFC107;
        }

        .close-coupon-btn {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #B91C1C, #DC143C);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 28px;
            color: white;
            box-shadow: 0 5px 20px rgba(185, 28, 28, 0.6);
            transition: all 0.3s ease;
            animation: pulse 2s ease-in-out infinite;
        }

        .close-coupon-btn:hover {
            transform: scale(1.2) rotate(90deg);
            box-shadow: 0 8px 30px rgba(185, 28, 28, 0.8);
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .coupon-sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            animation: twinkleStar 1.5s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes twinkleStar {
            0%, 100% {
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: scale(1) rotate(180deg);
            }
        }

        /* Question transition animations */
        .question-fade-out {
            animation: fadeOutSimple 0.4s ease-out forwards;
        }

        .question-fade-in {
            animation: fadeInSimple 0.5s ease-in forwards;
        }

        @keyframes fadeOutSimple {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        @keyframes fadeInSimple {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="dancing-font text-4xl mb-4">Booting up nuclear reactor.....</h2>
            <p class="text-lg opacity-90">üéÑ‚ú®</p>
            <div class="loading-bar-container">
                <div class="loading-bar"></div>
            </div>
        </div>
    </div>

    <!-- Snowflakes Container -->
    <div id="snowflakes-container"></div>

    <!-- Welcome Screen -->
    <div id="welcome-screen">
        <div class="polaroid-frame">
            <div class="polaroid-inner">
                <img src="image-1.jpg" alt="Christmas Photo 1" class="polaroid-img">
                <img src="image-2.jpg" alt="Christmas Photo 2" class="polaroid-img second">
                <div class="polaroid-caption">üéÑ</div>
            </div>
        </div>

        <h1 class="dancing-font text-3xl sm:text-5xl md:text-6xl text-red-700 mb-4 text-center px-4" style="text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 255, 255, 0.5);">
            Weso≈Çych ≈öwiƒÖt, Kochanie!
        </h1>

        <div class="text-center mb-6 max-w-lg px-6">
            <p class="text-gray-700 text-sm sm:text-lg mb-3 leading-relaxed">
                I told you a while ago that I don't really have anything for you for Christmas, and that's still true.
            </p>
            <p class="text-gray-700 text-sm sm:text-lg mb-3 leading-relaxed">
                I don't have anything <span class="italic font-semibold">physical</span>... But maybe something else?
            </p>
        </div>

        <button onclick="startQuiz()" class="start-btn bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 sm:py-4 sm:px-8 rounded-full text-base sm:text-xl heartbeat">
            Let's find out! üéÅ
        </button>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen">
        <div class="quiz-card">
            <h2 class="dancing-font text-2xl sm:text-4xl text-red-700 mb-2 text-center">
                D&P Trivia üéØ
            </h2>
            <p class="text-center text-gray-600 mb-4 text-xs sm:text-base">
                Answer correctly to unlock your gift!
            </p>

            <div class="quiz-progress text-center mb-4 text-xs sm:text-sm">
                Question <span id="current-question">1</span> of <span id="total-questions">3</span>
            </div>

            <div id="question-container">
                <!-- Questions will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Wrong Answer Popup -->
    <div class="popup-overlay" id="popup-overlay"></div>
    <div class="wrong-answer-popup" id="wrong-popup">
        <h3 class="dancing-font text-3xl text-red-700 mb-4">No Gift For You! üò≠</h3>
        <p class="text-gray-700 text-lg mb-6" id="wrong-message"></p>
        <button onclick="closePopup()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full">
            Lemme try again! üôè
        </button>
    </div>

    <!-- Scratch Screen -->
    <div id="scratch-screen">
        <h2 class="dancing-font text-3xl sm:text-4xl text-red-700 mb-4 sm:mb-6 text-center px-4">
            Scratch to Reveal Your Gift!
        </h2>

        <div class="mb-4 text-center scratch-hint px-4">
            <p class="text-gray-600 text-sm sm:text-base">üëÜ Scratch with your finger or mouse</p>
        </div>

        <canvas id="scratch-canvas" width="600" height="800"></canvas>

        <div id="progress-container" class="mt-6 w-full max-w-md">
            <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-red-600 to-green-600 h-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-center mt-2 text-sm text-gray-600">
                <span id="progress-text">0%</span> revealed
            </p>
        </div>
    </div>

    <!-- Prize Reveal Screen -->
    <div id="prize-screen">
        <!-- Stage 2: Teaser -->
        <div id="stage-2" class="hidden gift-card scale-in text-center">
            <h3 class="dancing-font text-2xl sm:text-3xl text-green-700 mb-4">
                Get ready for something sweet... üç´
            </h3>
            <p class="text-gray-600 text-base sm:text-lg">
                (And I'm not just talking about you üòò)
            </p>
        </div>

        <!-- Chocolate Rain will appear here -->
        <div id="chocolate-container"></div>

        <!-- Stage 3: The Big Reveal -->
        <div id="stage-3" class="hidden gift-card scale-in text-center">
            <h2 class="dancing-font text-3xl sm:text-4xl md:text-5xl text-red-700 mb-6">
                üç´ Bonbon Workshop! üç´
            </h2>

            <!-- Bonbon Image -->
            <div class="mb-6 rounded-lg overflow-hidden shadow-lg">
                <img src="chocolate.webp" alt="Delicious Bonbons" class="w-full h-auto object-cover" style="max-height: 300px;">
            </div>

            <div class="mb-6">
                <p class="text-gray-700 text-lg sm:text-xl mb-4 font-semibold">
                    We're going to make chocolates together!
                </p>
                <p class="text-gray-600 text-sm sm:text-base mb-4 leading-relaxed">
                    We'll learn from professionals, get creative with flavors, and most importantly...
                </p>
                <p class="text-gray-600 text-sm sm:text-base mb-4 leading-relaxed">
                    Get to eat it ü§§
            </div>

            <div class="bg-red-50 rounded-lg p-4 sm:p-6 mb-4 cursor-pointer hover:bg-red-100 transition-all duration-300 transform hover:scale-105" onclick="showCoupon()">
                <p class="text-red-700 text-xs sm:text-sm mb-2">üéÑ Your Christmas Gift üéÑ</p>
                <p class="text-gray-700 font-semibold text-base sm:text-lg">Bonbon Making Workshop</p>
                <p class="text-gray-600 text-xs sm:text-sm mt-2">Date: To be planned together ‚ù§Ô∏è</p>
                <p class="text-red-600 text-xs sm:text-sm mt-3 font-semibold">üëÜ Click to see your coupon!</p>
            </div>
        </div>
    </div>

    <!-- Coupon Modal -->
    <div id="coupon-modal" onclick="closeCoupon(event)">
        <div class="coupon-container">
            <div class="close-coupon-btn" onclick="closeCoupon(event)">√ó</div>
            <img src="coupon.png" alt="Your Bonbon Workshop Coupon" class="coupon-image">
            <!-- Sparkle decorations -->
            <div class="coupon-sparkle" style="top: -10px; left: 10%; font-size: 30px;">‚ú®</div>
            <div class="coupon-sparkle" style="top: -5px; right: 15%; font-size: 25px; animation-delay: 0.3s;">‚≠ê</div>
            <div class="coupon-sparkle" style="bottom: -10px; left: 20%; font-size: 28px; animation-delay: 0.6s;">üí´</div>
            <div class="coupon-sparkle" style="bottom: -5px; right: 10%; font-size: 26px; animation-delay: 0.9s;">‚ú®</div>
        </div>
    </div>

    <script>
        // Quiz data
        const quizQuestions = [
            {
                question: "What word was so difficult for me to pronounce our first Christmas together in Poland?",
                answers: [
                    { text: "A) Kurwa", correct: false, wrongMessage: "I'm pretty that was the opposite of difficult for anyone that's not Polish." },
                    { text: "B) Piwo", correct: false, wrongMessage: "Don't piss me off now..." },
                    { text: "C) Wszystkich", correct: true },
                    { text: "D) Dziewiƒôƒásetdziewiƒôƒádziesiƒôciodziewiƒôcionarodowo≈õciowego", correct: false, wrongMessage: "I mean, sure, if I had to even try it I would probably go disabled." }
                ],
                wrongMessage: "No gift for you!"
            },
            {
                question: "Where did we eat on our first dinner date in ≈Å√≥d≈∫?",
                answers: [
                    { text: "A) Farina Bianco", correct: false, wrongMessage: "I know your memory is bad, but that bad?!" },
                    { text: "B) Tabu", correct: true, dodgy: true },
                    { text: "C) McDonalds", correct: false, wrongMessage: "That woodcutters burger though..." },
                    { text: "D) Yalla yalla Kebab", correct: false, wrongMessage: "Frankly, we only go there when we're drunk xd" }
                ],
                wrongMessage: "Ha ha you so funny"
            },
            {
                question: "What probably makes you the happiest when you're sad?",
                answers: [
                    { text: "A) Chocolate", correct: true },
                    { text: "B) Chocolate", correct: true },
                    { text: "C) Chocolate", correct: true },
                    { text: "D) It's still chocolate", correct: true }
                ],
                wrongMessage: "Just kidding! They're all right! üç´",
                allCorrect: true,
                trickReveal: true
            }
        ];

        let currentQuestionIndex = 0;
        let jsConfetti = null;

        // Loading screen
        window.addEventListener('load', () => {
            // Initialize JSConfetti
            jsConfetti = new JSConfetti();

            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
            }, 2500);
        });

        // Create enhanced snowflakes
        function createSnowflakes() {
            const container = document.getElementById('snowflakes-container');
            const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];

            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.fontSize = (Math.random() * 30 + 15) + 'px';
                snowflake.style.animationDuration = (Math.random() * 10 + 8) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.opacity = (Math.random() * 0.5 + 0.6).toString();
                container.appendChild(snowflake);
            }
        }

        // Confetti explosion from sides
        function createConfetti() {
            if (!jsConfetti) return;

            // Left side confetti
            jsConfetti.addConfetti({
                confettiColors: ['#B91C1C', '#047857', '#FFC107', '#EC4899', '#8B5CF6', '#10B981'],
                confettiRadius: 6,
                confettiNumber: 100,
            });

            // Right side confetti with slight delay
            setTimeout(() => {
                jsConfetti.addConfetti({
                    confettiColors: ['#B91C1C', '#047857', '#FFC107', '#EC4899', '#8B5CF6', '#10B981'],
                    confettiRadius: 6,
                    confettiNumber: 100,
                });
            }, 150);
        }

        // Start quiz
        function startQuiz() {
            const welcomeScreen = document.getElementById('welcome-screen');
            const quizScreen = document.getElementById('quiz-screen');

            // Zoom out welcome screen
            welcomeScreen.classList.add('fade-out');

            setTimeout(() => {
                welcomeScreen.style.display = 'none';
                quizScreen.style.display = 'flex';
                quizScreen.classList.add('show');
                document.getElementById('total-questions').textContent = quizQuestions.length;
                showQuestion(true); // Animate first question on entry
            }, 500);
        }

        // Display current question
        function showQuestion(animate = true) {
            const question = quizQuestions[currentQuestionIndex];
            const container = document.getElementById('question-container');
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;

            container.innerHTML = `
                <div class="${animate ? 'question-fade-in' : ''}">
                    <h3 class="text-base sm:text-xl font-semibold text-gray-800 mb-4 leading-relaxed">${question.question}</h3>
                    <div class="space-y-2 sm:space-y-3">
                        ${question.answers.map((answer, index) => `
                            <button onclick="handleAnswerClick(${index})"
                                    data-answer-index="${index}"
                                    class="answer-btn w-full text-left p-2.5 sm:p-4 rounded-lg ${answer.dodgy ? 'dodgy-btn' : ''}">
                                ${answer.text}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        let dodgeCount = 0;
        const MAX_DODGES = 2;

        function handleAnswerClick(answerIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const answer = question.answers[answerIndex];

            // If it's the dodgy button and hasn't dodged enough times yet
            if (answer.dodgy && dodgeCount < MAX_DODGES) {
                dodgeCount++;
                const btn = document.querySelector(`[data-answer-index="${answerIndex}"]`);

                // Prevent any styling changes - disable button temporarily and remove any existing classes
                btn.classList.remove('wrong', 'correct');
                btn.classList.add('dodging');
                btn.disabled = true;

                // Force white background and gray border during dodge
                btn.style.backgroundColor = 'white';
                btn.style.borderColor = '#e5e7eb';

                // Random diagonal movement
                const directions = [
                    { x: -120, y: -60 },  // up-left
                    { x: 120, y: -60 },   // up-right
                    { x: -120, y: 60 },   // down-left
                    { x: 120, y: 60 },    // down-right
                    { x: 0, y: -80 },     // straight up
                    { x: 0, y: 80 }       // straight down
                ];
                const randomDirection = directions[Math.floor(Math.random() * directions.length)];

                btn.style.transform = `translateX(${randomDirection.x}px) translateY(${randomDirection.y}px)`;

                // Reset position after a moment
                setTimeout(() => {
                    btn.style.transform = 'translateX(0) translateY(0)';
                    btn.classList.remove('dodging');
                    btn.disabled = false;
                    // Remove inline styles so CSS can take over
                    btn.style.backgroundColor = '';
                    btn.style.borderColor = '';
                }, 600);

                return; // Don't check the answer yet
            }

            // Reset dodge count for next question
            dodgeCount = 0;

            // Proceed with normal answer checking
            checkAnswer(answerIndex);
        }

        // Check answer
        function checkAnswer(answerIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const answerBtns = document.querySelectorAll('.answer-btn');
            const selectedBtn = answerBtns[answerIndex];

            // Disable all buttons (but not during dodging)
            answerBtns.forEach(btn => btn.disabled = true);

            if (question.trickReveal) {
                // Show wrong first, then reveal they're all correct
                selectedBtn.classList.add('wrong');
                document.getElementById('wrong-message').textContent = question.wrongMessage;

                // Hide the retry button for trick questions
                const retryBtn = document.querySelector('#wrong-popup button');
                if (retryBtn) retryBtn.style.display = 'none';

                document.getElementById('popup-overlay').classList.add('show');
                document.getElementById('wrong-popup').classList.add('show');

                // After 3 seconds, close popup and show success
                setTimeout(() => {
                    document.getElementById('popup-overlay').classList.remove('show');
                    document.getElementById('wrong-popup').classList.remove('show');

                    setTimeout(() => {
                        // Show retry button again for next questions (after popup is fully hidden)
                        if (retryBtn) retryBtn.style.display = '';

                        selectedBtn.classList.remove('wrong');
                        selectedBtn.classList.add('correct');
                        setTimeout(nextQuestion, 2000); // Was 1500 - now 2 seconds
                    }, 500);
                }, 3000); // Was 2000 - now 3 seconds for trick reveal
            } else if (question.answers[answerIndex].correct) {
                // Correct answer
                selectedBtn.classList.add('correct');
                setTimeout(nextQuestion, 2000); // Was 1500 - now 2 seconds
            } else {
                // Wrong answer - use specific message if available, otherwise use default
                selectedBtn.classList.add('wrong');
                const wrongMsg = question.answers[answerIndex].wrongMessage || question.wrongMessage;
                document.getElementById('wrong-message').textContent = wrongMsg;
                document.getElementById('popup-overlay').classList.add('show');
                document.getElementById('wrong-popup').classList.add('show');
            }
        }

        // Close popup and retry
        function closePopup() {
            document.getElementById('popup-overlay').classList.remove('show');
            document.getElementById('wrong-popup').classList.remove('show');

            // Re-enable buttons and remove wrong class
            const answerBtns = document.querySelectorAll('.answer-btn');
            answerBtns.forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('wrong');
            });
        }

        // Next question or finish
        function nextQuestion() {
            const container = document.getElementById('question-container');
            const questionDiv = container.querySelector('div');

            // Add fade-out animation
            if (questionDiv) {
                questionDiv.classList.add('question-fade-out');
            }

            // Wait for fade-out to complete before showing next question
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizQuestions.length) {
                    // Clear the old question first
                    container.innerHTML = '';
                    // Show new question immediately after clearing
                    showQuestion(true);
                } else {
                    // Quiz completed! Celebrate with confetti!
                    createConfetti();

                    const quizScreen = document.getElementById('quiz-screen');
                    const scratchScreen = document.getElementById('scratch-screen');

                    // Slide out quiz screen
                    setTimeout(() => {
                        quizScreen.classList.add('fade-out');
                    }, 1000);

                    // Wait for confetti and transition, then show scratch game
                    setTimeout(() => {
                        quizScreen.style.display = 'none';
                        quizScreen.classList.remove('fade-out', 'show');
                        scratchScreen.style.display = 'flex';
                        scratchScreen.classList.add('show');
                        initScratchCard();
                    }, 1800);
                }
            }, 450); // Wait for fade-out animation to complete (0.4s)
        }

        // Start the game (legacy function for scratch card)
        function startGame() {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('scratch-screen').style.display = 'flex';
            initScratchCard();
        }

        // Scratch card implementation
        let canvas, ctx, isDrawing = false, scratchedPercent = 0;

        function initScratchCard() {
            canvas = document.getElementById('scratch-canvas');
            ctx = canvas.getContext('2d');

            // Reset transition states
            middleFingerRevealed = false;
            giftTransitioned = false;
            window.revealStarted = false;

            // Adjust canvas for mobile
            const maxWidth = Math.min(600, window.innerWidth - 40);
            const maxHeight = Math.min(800, window.innerHeight - 300);
            canvas.width = maxWidth;
            canvas.height = maxHeight;

            // Draw wrapping paper
            drawWrappingPaper();

            // Draw hidden gift underneath - starts with middle finger joke!
            drawGiftImage(true);

            // Mouse events
            canvas.addEventListener('mousedown', startScratching);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('mouseup', stopScratching);
            canvas.addEventListener('mouseleave', stopScratching);

            // Touch events
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopScratching);
        }

        function drawWrappingPaper() {
            // Create festive wrapping paper pattern
            ctx.fillStyle = '#B91C1C'; // Red background
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add Christmas patterns
            ctx.strokeStyle = '#047857';
            ctx.lineWidth = 3;

            // Draw diagonal stripes
            for (let i = -canvas.height; i < canvas.width + canvas.height; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i + canvas.height, canvas.height);
                ctx.stroke();
            }

            // Add gold dots
            ctx.fillStyle = '#FFC107';
            for (let x = 20; x < canvas.width; x += 60) {
                for (let y = 20; y < canvas.height; y += 60) {
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Add overlay text
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.font = 'bold 40px Dancing Script';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üéÅ', canvas.width / 2, canvas.height / 2 - 40);
            ctx.font = 'bold 30px Poppins';
            ctx.fillText('Scratch Here!', canvas.width / 2, canvas.height / 2 + 20);

            // Set composite operation for scratching
            ctx.globalCompositeOperation = 'destination-out';
        }

        function drawGiftImage(isMiddleFinger = true) {
            // This will be visible underneath the wrapping paper
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');

            if (isMiddleFinger) {
                // Draw middle finger emoji - the joke reveal!
                tempCtx.fillStyle = '#FDE2E4'; // Light pink background
                tempCtx.fillRect(0, 0, canvas.width, canvas.height);

                // Big middle finger emoji
                tempCtx.font = `bold ${canvas.width * 0.4}px Arial`;
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                tempCtx.fillText('üñï', canvas.width / 2, canvas.height / 2 - 40);

                // Cheeky text
                tempCtx.fillStyle = '#B91C1C';
                tempCtx.font = `bold ${canvas.width * 0.06}px Poppins`;
                tempCtx.fillText('Just kidding! üòÇ', canvas.width / 2, canvas.height / 2 + canvas.height * 0.25);
            } else {
                // Draw green gift box - the real gift
                tempCtx.fillStyle = '#D1FAE5'; // Light green background
                tempCtx.fillRect(0, 0, canvas.width, canvas.height);

                const boxWidth = canvas.width * 0.6;
                const boxHeight = canvas.height * 0.5;
                const boxX = (canvas.width - boxWidth) / 2;
                const boxY = canvas.height * 0.3;

                // Box body - green
                tempCtx.fillStyle = '#047857';
                tempCtx.fillRect(boxX, boxY, boxWidth, boxHeight);

                // Box ribbon - gold
                tempCtx.fillStyle = '#FFC107';
                const ribbonWidth = boxWidth * 0.15;
                tempCtx.fillRect(boxX + boxWidth / 2 - ribbonWidth / 2, boxY, ribbonWidth, boxHeight);
                tempCtx.fillRect(boxX, boxY + boxHeight / 2 - ribbonWidth / 2, boxWidth, ribbonWidth);

                // Bow
                tempCtx.beginPath();
                tempCtx.arc(boxX + boxWidth / 2, boxY + boxHeight / 2, boxWidth * 0.15, 0, Math.PI * 2);
                tempCtx.fill();

                // Text
                tempCtx.fillStyle = '#047857';
                tempCtx.font = 'bold 32px Dancing Script';
                tempCtx.textAlign = 'center';
                tempCtx.fillText('Your Real Gift! üéÅ', canvas.width / 2, boxY + boxHeight + 50);
            }

            // Place under main canvas
            canvas.style.backgroundImage = `url(${tempCanvas.toDataURL()})`;
            canvas.style.backgroundSize = 'cover';
        }

        function startScratching(e) {
            isDrawing = true;
            scratch(e);
        }

        function stopScratching() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            isDrawing = true;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            scratchAt(touch.clientX - rect.left, touch.clientY - rect.top);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            scratchAt(touch.clientX - rect.left, touch.clientY - rect.top);
        }

        function scratch(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            scratchAt(e.clientX - rect.left, e.clientY - rect.top);
        }

        function scratchAt(x, y) {
            // Scale coordinates
            const scaleX = canvas.width / canvas.offsetWidth;
            const scaleY = canvas.height / canvas.offsetHeight;
            x *= scaleX;
            y *= scaleY;

            ctx.beginPath();
            ctx.arc(x, y, 30, 0, Math.PI * 2);
            ctx.fill();

            // Check scratch progress
            checkProgress();
        }

        let lastCheck = 0;
        let middleFingerRevealed = false;
        let giftTransitioned = false;

        function checkProgress() {
            const now = Date.now();
            if (now - lastCheck < 200) return; // Throttle checks
            lastCheck = now;

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let transparent = 0;

            for (let i = 3; i < imageData.data.length; i += 4) {
                if (imageData.data[i] < 128) transparent++;
            }

            scratchedPercent = Math.round((transparent / (imageData.data.length / 4)) * 100);

            document.getElementById('progress-bar').style.width = scratchedPercent + '%';
            document.getElementById('progress-text').textContent = scratchedPercent + '%';

            // At 50% middle finger is fully visible - transition to prize reveal
            if (scratchedPercent >= 50 && !giftTransitioned) {
                giftTransitioned = true;
                transitionToPrize();
            }
        }

        function transitionToPrize() {
            // Wait a moment to let them see the middle finger joke
            setTimeout(() => {
                // Fade out scratch screen
                const scratchScreen = document.getElementById('scratch-screen');
                scratchScreen.style.transition = 'opacity 0.8s';
                scratchScreen.style.opacity = '0';

                // Then reveal the actual gift
                setTimeout(() => {
                    revealGift();
                }, 800);
            }, 1500);
        }

        function revealGift() {
            const scratchScreen = document.getElementById('scratch-screen');
            const prizeScreen = document.getElementById('prize-screen');

            scratchScreen.style.display = 'none';
            prizeScreen.style.display = 'flex';
            prizeScreen.classList.add('show');

            // Skip stage 1, go directly to stage 2
            setTimeout(() => {
                document.getElementById('stage-2').classList.remove('hidden');
            }, 800);

            setTimeout(() => {
                startChocolateRain();
            }, 2800); // Start chocolate rain 2 seconds after stage 2 appears

            setTimeout(() => {
                document.getElementById('stage-2').classList.add('hidden');
                document.getElementById('stage-3').classList.remove('hidden');
                stopChocolateRain();
                createSparkles();
            }, 8800); // Show final reveal after 8 seconds total
        }

        // Chocolate rain effect
        let chocolateInterval;
        function startChocolateRain() {
            // Only chocolate and bonbon related emojis
            const chocolates = ['üç´', 'üç¨', 'üßà', 'üç™', 'üéÇ', '‚òï', 'ü••'];
            chocolateInterval = setInterval(() => {
                const chocolate = document.createElement('div');
                chocolate.className = 'chocolate';
                chocolate.textContent = chocolates[Math.floor(Math.random() * chocolates.length)];
                chocolate.style.left = Math.random() * 100 + '%';
                chocolate.style.animationDuration = (Math.random() * 3 + 3) + 's';
                document.getElementById('chocolate-container').appendChild(chocolate);

                setTimeout(() => chocolate.remove(), 6000);
            }, 200);
        }

        function stopChocolateRain() {
            clearInterval(chocolateInterval);
            setTimeout(() => {
                document.getElementById('chocolate-container').innerHTML = '';
            }, 3000);
        }

        function createSparkles() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = Math.random() * 100 + '%';
                    sparkle.style.top = Math.random() * 100 + '%';
                    document.body.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1000);
                }, i * 50);
            }
        }

        // Coupon Modal Functions
        function showCoupon() {
            const modal = document.getElementById('coupon-modal');
            modal.classList.add('show');

            // Add confetti celebration
            if (jsConfetti) {
                jsConfetti.addConfetti({
                    confettiColors: ['#FFC107', '#B91C1C', '#047857', '#FFD700', '#DC143C'],
                    confettiRadius: 6,
                    confettiNumber: 150,
                });
            }

            // Prevent body scrolling when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeCoupon(event) {
            // Only close if clicking the background or close button
            if (event.target.id === 'coupon-modal' || event.target.classList.contains('close-coupon-btn')) {
                const modal = document.getElementById('coupon-modal');
                modal.classList.remove('show');

                // Re-enable body scrolling
                document.body.style.overflow = '';
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('coupon-modal');
                if (modal.classList.contains('show')) {
                    modal.classList.remove('show');
                    document.body.style.overflow = '';
                }
            }
        });

        // Initialize snowflakes on page load
        createSnowflakes();
    </script>
</body>
</html>
